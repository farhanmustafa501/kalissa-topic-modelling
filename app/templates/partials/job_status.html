{% set cls = 'alert-info' %}
{% if status.status == 'SUCCEEDED' %}{% set cls = 'alert-success' %}{% endif %}
{% if status.status == 'FAILED' %}{% set cls = 'alert-danger' %}{% endif %}
{% set total = status.total or 0 %}
{% set step = status.step or 0 %}
{% set pct = (step * 100 // (total if total else 1)) %}
{% set steps = [
	'Chunking documents',
	'Generating embeddings',
	'Clustering chunks',
	'Resetting previous topics',
	'Generating topic labels',
	'Generating topic insights',
	'Ranking documents',
	'Building relationships',
	'Finalizing',
	'Complete'
] %}
<div id="job-status" class="alert {{ cls }} py-2 mb-0" data-job-state="{{ status.status }}" data-job-id="{{ job_id if job_id else '' }}">
	<div class="d-flex align-items-center justify-content-between">
		<div>
			<strong>{{ status.status }}</strong>
			{% if total %}<span class="ms-2">Step {{ step }}/{{ total }}</span>{% endif %}
			{% if status.label %}<span class="ms-2">{{ status.label }}</span>{% endif %}
		</div>
		<div class="d-flex align-items-center gap-2 ms-3">
			{% if status.status in ['PENDING','RUNNING','FAILED','SUCCEEDED'] %}
			<button 
				class="btn btn-outline-danger btn-sm"
				hx-delete="/api/collections/{{ collection_id }}/discover/last_job"
				hx-confirm="Delete the last discovery job?"
				hx-target="#job-status"
				hx-swap="outerHTML">
				Delete Job
			</button>
			{% endif %}
		</div>
		{% if total %}
		<div class="flex-grow-1 ms-3">
			<div class="progress" style="height: 6px;">
				<div class="progress-bar" role="progressbar" style="width: {{ pct }}%;" aria-valuenow="{{ pct }}" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
		</div>
		{% endif %}
	</div>
	{% if total %}
	<ul class="job-steps">
		{% for s in range(total) %}
		<li class="{% if (s + 1) == step %}current{% endif %}">
			<span class="step-dot"></span>
			<span>{{ steps[s] if s < steps|length else ('Step ' ~ (s + 1)) }}</span>
		</li>
		{% endfor %}
	</ul>
	{% endif %}
</div>



